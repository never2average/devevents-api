language: node_js
node_js:
  - 10

branches:
  only:
   - master

cache:
  directories:
    - $HOME/gcloud/
    - node_modules

env:
  global:
    # - secure: "eeuhASPfOvjwdGadQsej82RDP/at1pB7Q2h4uRyAMEaJ1W5x2PcHarcq8bMQYC4q+s2lNBz5zBAOxC54dQouDDN5H8IprWMj3yfUdEGKIkwwQvzCx51B1fJU0glbzE8jGBfsS77wFUclPWmHFvcF/PYs3BBguM54CVPzH0k+oJ8nasg5HvpBNuZnCwaz92vOJwwR32DwaaS8BVdgMWHt+gLVSN+fN59tVn8RdXwUlOb0cEvNTk+TETjy4ilG8QfWnqEfJh2AMWT8nsHHuxDoenmvgYPeVluH69jGAo6nTUkBOGRrlxT8MoxLXzJjEmFh2THzxM1ZvzLJ3tdfgH+tU97xaf2f0j27D+FJtsKXy9TRLs4UiAiFl41aZVXb/NZdIJduAjiP0tm51OjMsb7hJkxFVd0oD86xK5XEvbrS8M6wNWOKn8Bw67WDrbqbRnXYKoEy6SIicrrD+LVThUf7xvLQaob7MknBfWFYSNrr7JWtFegcF8D6C4264iFMWa7YG8fvgZLMezbRPcsL6lU0mcxJN4Czh9QOqW0uWMe6KrojMgTEXhm9bePLHXhdJ5kyEWRsHr0VC1kosGd4XPK51B0XQ12/e5Mu+0CTmFeG6/V0vaD0zgtV3NqL9GWrf6nbh9ZzaXzCQ/Cm3/QbYeehjPmlNOFiehtK2Anvh3Nnl04="   
  matrix:
    - PATH=$PATH:$HOME/gcloud/google-cloud-sdk/bin GOOGLE_APPLICATION_CREDENTIALS=$TRAVIS_BUILD_DIR/.gcloud-travis.json

before_install:
  - openssl aes-256-cbc -K $encrypted_3f48101487a4_key -iv $encrypted_3f48101487a4_iv -in .gcloud-travis.json.enc -out .gcloud-travis.json -d
  - export CLOUD_SDK_REPO="cloud-sdk-$(lsb_release -c -s)" && 
    echo "deb http://packages.cloud.google.com/apt $CLOUD_SDK_REPO main" | sudo tee -a /etc/apt/sources.list.d/google-cloud-sdk.list && 
    curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add - && 
    sudo apt-get update -y && 
    sudo apt-get install google-cloud-sdk=216.0.0-0 -y
  - if [ -a .gcloud-travis.json ]; then
      gcloud -q auth activate-service-account --key-file .gcloud-travis.json;
    fi

script:
  - npm install
  - gcloud functions deploy api --runtime nodejs10 --trigger-http --project devevents --verbosity=debug --memory=1024MB --timeout=60s